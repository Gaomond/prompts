
# instruction to CLAUDE

ultrathink.

## Context

本PJの概要は[01_inception_deck.md](docs/agile/01_inception_deck.md)に記載してあります。なにより第一に、このドキュメントを参照してください。**すべてのタスクはこのコンテキスト上で実施される必要があります。**

`.prompts`に、あなたが遵守すべきプロンプトが格納されています。
タスクの種類によって参照すべきファイルは異なります。必ずタスク着手前にこれらファイルのうち、どの指示を遵守すべきかを確認してください。
複数のプロンプトファイルを参照すべきタスクもあります。過不足なく指示を遵守してください。
タスクに着手する前に、どのファイルを参照したのかを宣言してから始めてください。

## Cost Management

あなたは優秀なエンジニアですが、リソース（トークン・APIコスト）は有限です。以下のルールを厳守してください。

### 1. Stop & Think (思考停止の禁止)

コードを書き始める前に、必ず `<thinking>` ブロックで以下の手順を実行してください。

1. 要求の理解: ユーザーは何を求めているか？
2. 影響範囲の特定: どのファイル、どのレイヤーを変更する必要があるか？
3. プランニング: 最小の手順で実装するにはどうすればよいか？

### 2. ファイル作成計画

ファイル作成を伴うタスクでは、必ず`tree`コマンドを実行するなどして現在のディレクトリ構成を確認し、どのフォルダにどんなファイルを作成すればよいか計画を立ててからタスクに着手してください。

### 3. Loop Prevention (泥沼回避)

- エラーが**3回**続いた場合、自律修正を停止し、ユーザーに「方針の確認」を求めてください。
- 同じファイルの修正を繰り返さないでください。

### 4. File Management

- 1ファイルは200行を目安とします。これを超える場合はリファクタリング（分割）を提案してください。

## Contraints

ホストマシンの環境を汚染しないため、以下の行為を固く禁じます。

1. システムパッケージマネージャーの使用禁止
   - 禁止: apt, apt-get, dnf, yum, pacman, snap等
   - 禁止: sudo を伴うコマンド全般
   - 禁止: /usr/local や /etc などのシステムディレクトリへの書き込み
2. 指定ディレクトリ以外でのパッケージインストール
   - Python: `/apps/api`での`uv add`のみ許可
   - Node.js: `/apps/web`でのnpm install のみ許可 (-g は禁止)

上記以外の方法でツールが必要な場合は、インストールせずに代替手段を考えるか、実行前に私に許可を求めてください。

また、コード品質を保つため、以下の行為を固く禁じます。

3. configファイルや静的解析の設定値変更
   - `pyproject.toml`や、`eslint.config.js`、`tsconfig.json`等。
4. インラインコメントによる静的解析の回避
   - Python: `# noqa`, `# type: ignore`, `# fmt: off` 等
   - TS/JS: `// eslint-disable`, `// @ts-ignore` 等

## type safe

F/E, B/Eそれぞれ、下記に示す静的解析を適宜走らせ、型安全性を確保しながら開発を進めてください。

- F/E
  - `npm run check:all`。エラーが出た場合はまずは`npm run fix:all`を実行してください。
- B/E
  - `uv run task check-all`。エラーが出た場合はまずは`uv run task fix-all`を実行してください。
